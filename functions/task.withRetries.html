<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>withRetries | True Myth - v8.5.1</title><meta name="description" content="Documentation for True Myth"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">True Myth - v8.5.1</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">True Myth</a></li><li><a href="../modules/task.html">task</a></li><li><a href="task.withRetries.html">withRetries</a></li></ul><h1>Function withRetries</h1></div><section class="tsd-panel"><ul class="tsd-signatures"><li class="tsd-signature tsd-anchor-link"><a id="withretries" class="tsd-anchor"></a><span class="tsd-kind-call-signature">withRetries</span><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="task.withRetries.html#withretriest">T</a><span class="tsd-signature-symbol">,</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="task.withRetries.html#withretriese">E</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">retryable</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-symbol">(</span><br/>        <span class="tsd-kind-parameter">status</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/task.RetryStatus.html" class="tsd-signature-type tsd-kind-interface">RetryStatus</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <a href="../classes/task.StopRetrying.html" class="tsd-signature-type tsd-kind-class">StopRetrying</a> <span class="tsd-signature-symbol">|</span> <a href="../classes/task.Task.html" class="tsd-signature-type tsd-kind-class">Task</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="task.withRetries.html#withretriest">T</a><span class="tsd-signature-symbol">,</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="task.withRetries.html#withretriese">E</a> <span class="tsd-signature-symbol">|</span> <a href="../classes/task.StopRetrying.html" class="tsd-signature-type tsd-kind-class">StopRetrying</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">strategy</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">IterableIterator</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <a href="../classes/task.Task.html" class="tsd-signature-type tsd-kind-class">Task</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="task.withRetries.html#withretriest">T</a><span class="tsd-signature-symbol">,</span> <a href="../classes/task.RetryFailed.html" class="tsd-signature-type tsd-kind-class">RetryFailed</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="task.withRetries.html#withretriese">E</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">&gt;</span><a href="#withretries" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></li><li class="tsd-description"><div class="tsd-comment tsd-typography"><p>Execute a callback that produces either a <a href="../classes/task.Task.html" class="tsd-kind-class"><code>Task</code></a> or the “sentinel”
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error"><code>Error</code></a> subclass <a href="../classes/task.StopRetrying.html" class="tsd-kind-class"><code>StopRetrying</code></a>. <code>withRetries</code> retries
the <code>retryable</code> callback until the retry strategy is exhausted <em>or</em> until the
callback returns either <code>StopRetrying</code> or a <code>Task</code> that rejects with
<code>StopRetrying</code>. If no strategy is supplied, a default strategy of retrying
immediately up to three times is used.</p>
<p>The <code>strategy</code> is any iterable iterator that produces an integral number,
which is used as the number of milliseconds to delay before retrying the
<code>retryable</code>. When the <code>strategy</code> stops yielding values, this will produce a
<a href="../interfaces/task.Rejected.html" class="tsd-kind-interface"><code>Rejected</code></a> <code>Task</code> whose rejection value is an instance of
<a href="../classes/task.RetryFailed.html" class="tsd-kind-class"><code>RetryFailed</code></a>.</p>
<p>Returning <code>stopRetrying()</code> from the top-level of the function or as the
rejection reason will also produce a rejected <code>Task</code> whose rejection value is
an instance of <code>RetryFailed</code>, but will also immediately stop all further
retries and will include the <code>StopRetrying</code> instance as the <code>cause</code> of the
<code>RetryFailed</code> instance.</p>
<p>You can determine whether retries stopped because the strategy was exhausted
or because <code>stopRetrying</code> was called by checking the <code>cause</code> on the
<code>RetryFailed</code> instance. It will be <code>undefined</code> if the the <code>RetryFailed</code> was
the result of the strategy being exhausted. It will be a <code>StopRetrying</code> if it
stopped because the caller returned <code>stopRetrying()</code>.</p>
<a id="examples" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Examples<a href="#examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="retrying-with-backoff" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Retrying with backoff<a href="#retrying-with-backoff" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>When attempting to fetch data from a server, you might want to retry if and
only if the response was an HTTP 408 response, indicating that there was a
timeout but that the client is allowed to try again. For other error codes, it
will simply reject immediately.</p>
<pre><code class="ts"><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-3">*</span><span class="hl-1"> </span><span class="hl-5">as</span><span class="hl-1"> </span><span class="hl-6">Task</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;true-myth/task&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-3">*</span><span class="hl-1"> </span><span class="hl-5">as</span><span class="hl-1"> </span><span class="hl-6">Delay</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;true-myth/task/delay&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-6">theTask</span><span class="hl-1"> = </span><span class="hl-0">withRetries</span><span class="hl-1">(</span><br/><span class="hl-1">  () </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-6">Task</span><span class="hl-1">.</span><span class="hl-0">fromPromise</span><span class="hl-1">(</span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-2">&#39;https://example.com&#39;</span><span class="hl-1">)).</span><span class="hl-0">andThen</span><span class="hl-1">((</span><span class="hl-6">res</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1"> === </span><span class="hl-9">200</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-6">Task</span><span class="hl-1">.</span><span class="hl-0">fromPromise</span><span class="hl-1">(</span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">());</span><br/><span class="hl-1">      } </span><span class="hl-5">else</span><span class="hl-1"> </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1"> === </span><span class="hl-9">408</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-6">Task</span><span class="hl-1">.</span><span class="hl-0">reject</span><span class="hl-1">(</span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-6">statusText</span><span class="hl-1">);</span><br/><span class="hl-1">      } </span><span class="hl-5">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-6">Task</span><span class="hl-1">.</span><span class="hl-0">stopRetrying</span><span class="hl-1">(</span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-6">statusText</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }),</span><br/><span class="hl-1">  </span><span class="hl-6">Delay</span><span class="hl-1">.</span><span class="hl-0">fibonacci</span><span class="hl-1">().</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-6">Delay</span><span class="hl-1">.</span><span class="hl-6">jitter</span><span class="hl-1">).</span><span class="hl-0">take</span><span class="hl-1">(</span><span class="hl-9">10</span><span class="hl-1">)</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>Here, this uses a Fibonacci backoff strategy, which can be preferable in some
cases to a classic exponential backoff strategy (see <a href="https://www.researchgate.net/publication/255672213_A_Performance_Comparison_of_Different_Backoff_Algorithms_under_Different_Rebroadcast_Probabilities_for_MANET's">A Performance Comparison
of Different Backoff Algorithms under Different Rebroadcast Probabilities for
MANET's</a> for more details).</p>
<a id="manually-canceling-retries" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Manually canceling retries<a href="#manually-canceling-retries" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Sometimes, you may determine that the result of an operation is fatal, so
there is no point in retrying even if the retry strategy still allows it. In
that case, you can return the special <code>StopRetrying</code> error produced by calling
<code>stopRetrying</code> to immediately stop all further retries.</p>
<p>For example, imagine you have a library function that returns a custom <code>Error</code>
subclass that includes an <code>isFatal</code> value on it, something like this::</p>
<pre><code class="ts"><span class="hl-3">class</span><span class="hl-1"> </span><span class="hl-7">AppError</span><span class="hl-1"> </span><span class="hl-3">extends</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">isFatal</span><span class="hl-1">: </span><span class="hl-7">boolean</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">constructor</span><span class="hl-1">(</span><span class="hl-6">message</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">, </span><span class="hl-6">options</span><span class="hl-1">?: { </span><span class="hl-6">isFatal</span><span class="hl-1">?: </span><span class="hl-7">boolean</span><span class="hl-1">, </span><span class="hl-6">cause</span><span class="hl-1">?: </span><span class="hl-7">unknown</span><span class="hl-1"> }) {</span><br/><span class="hl-1">    </span><span class="hl-3">super</span><span class="hl-1">(</span><span class="hl-6">message</span><span class="hl-1">, { </span><span class="hl-6">cause:</span><span class="hl-1"> </span><span class="hl-6">options</span><span class="hl-1">?.</span><span class="hl-6">cause</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-3">this</span><span class="hl-1">.</span><span class="hl-6">isFatal</span><span class="hl-1"> = </span><span class="hl-6">options</span><span class="hl-1">?.</span><span class="hl-6">isFatal</span><span class="hl-1"> ?? </span><span class="hl-3">false</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>You could check that flag in a <code>Task</code> rejection and return <code>stopRetrying()</code> if
it is set:</p>
<pre><code class="ts"><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-3">*</span><span class="hl-1"> </span><span class="hl-5">as</span><span class="hl-1"> </span><span class="hl-6">Task</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;true-myth/task&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">fibonacci</span><span class="hl-1">, </span><span class="hl-6">jitter</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;true-myth/task/delay&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">doSomethingThatMayFailWithAppError</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;someplace/in/my-app&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-6">theTask</span><span class="hl-1"> = </span><span class="hl-6">Task</span><span class="hl-1">.</span><span class="hl-0">withRetries</span><span class="hl-1">(</span><br/><span class="hl-1">  () </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">doSomethingThatMayFailWithAppError</span><span class="hl-1">().</span><span class="hl-0">orElse</span><span class="hl-1">((</span><span class="hl-6">rejection</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">rejection</span><span class="hl-1">.</span><span class="hl-6">isFatal</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-6">Task</span><span class="hl-1">.</span><span class="hl-0">stopRetrying</span><span class="hl-1">(</span><span class="hl-2">&quot;It was fatal!&quot;</span><span class="hl-1">, { </span><span class="hl-6">cause:</span><span class="hl-1"> </span><span class="hl-6">rejection</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><br/><span class="hl-1">      </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-6">Task</span><span class="hl-1">.</span><span class="hl-0">reject</span><span class="hl-1">(</span><span class="hl-6">rejection</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">fibonacci</span><span class="hl-1">().</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-6">jitter</span><span class="hl-1">).</span><span class="hl-0">take</span><span class="hl-1">(</span><span class="hl-9">20</span><span class="hl-1">)</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="using-the-retry-status-parameter" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Using the retry <code>status</code> parameter<a href="#using-the-retry-status-parameter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Every time <code>withRetries</code> tries the <code>retryable</code>, it provides the current count
of attempts and the total elapsed duration as properties on the <code>status</code>
object, so you can do different things for a given way of trying the async
operation represented by the <code>Task</code> depending on the count. Here, for example,
the task is retried if the HTTP request rejects, with an exponential backoff
starting at 100 milliseconds, and captures the number of retries in an <code>Error</code>
wrapping the rejection reason when the response rejects or when converting the
response to JSON fails. It also stops if it has tried the call more than 10
times or if the total elapsed time exceeds 10 seconds.</p>
<pre><code class="ts"><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-3">*</span><span class="hl-1"> </span><span class="hl-5">as</span><span class="hl-1"> </span><span class="hl-6">Task</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;true-myth/task&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">exponential</span><span class="hl-1">, </span><span class="hl-6">jitter</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;true-myth/task/delay&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-6">theResult</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-6">Task</span><span class="hl-1">.</span><span class="hl-0">withRetries</span><span class="hl-1">(</span><br/><span class="hl-1">  ({ </span><span class="hl-6">count</span><span class="hl-1">, </span><span class="hl-6">elapsed</span><span class="hl-1"> }) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">count</span><span class="hl-1"> &gt; </span><span class="hl-9">10</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-6">Task</span><span class="hl-1">.</span><span class="hl-0">stopRetrying</span><span class="hl-1">(</span><span class="hl-2">`Tried too many times: </span><span class="hl-3">${</span><span class="hl-6">count</span><span class="hl-3">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">elapsed</span><span class="hl-1"> &gt; </span><span class="hl-9">10_000</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-6">Task</span><span class="hl-1">.</span><span class="hl-0">stopRetrying</span><span class="hl-1">(</span><span class="hl-2">`Took too long: </span><span class="hl-3">${</span><span class="hl-6">elapsed</span><span class="hl-3">}</span><span class="hl-2">ms`</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-6">Task</span><span class="hl-1">.</span><span class="hl-0">fromPromise</span><span class="hl-1">(</span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-2">&#39;https://www.example.com/&#39;</span><span class="hl-1">))</span><br/><span class="hl-1">      .</span><span class="hl-0">andThen</span><span class="hl-1">((</span><span class="hl-6">res</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-6">Task</span><span class="hl-1">.</span><span class="hl-0">fromPromise</span><span class="hl-1">(</span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">()))</span><br/><span class="hl-1">      .</span><span class="hl-0">orElse</span><span class="hl-1">((</span><span class="hl-6">cause</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-6">message</span><span class="hl-1"> = </span><span class="hl-2">`Attempt #</span><span class="hl-3">${</span><span class="hl-6">count</span><span class="hl-3">}</span><span class="hl-2"> failed`</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-6">Task</span><span class="hl-1">.</span><span class="hl-0">reject</span><span class="hl-1">(</span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-6">message</span><span class="hl-1">, { </span><span class="hl-6">cause</span><span class="hl-1"> }));</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">exponential</span><span class="hl-1">().</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-6">jitter</span><span class="hl-1">),</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="custom-strategies" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Custom strategies<a href="#custom-strategies" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>While the <a href="../modules/task_delay.html" class="tsd-kind-module">task/delay</a> module supplies a number of useful strategies,
you can also supply your own. The easiest way is to write [a generator
function][gen], but you can also implement a custom iterable iterator,
including by providing a subclass of the ES2025 <code>Iterator</code> class.</p>
<p>Here is an example of using a generator function to produce a random but
<a href="https://en.wikipedia.org/wiki/Monotonic_function">monotonically increasing</a> value proportional to the current
value:</p>
<pre><code class="ts"><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-3">*</span><span class="hl-1"> </span><span class="hl-5">as</span><span class="hl-1"> </span><span class="hl-6">Task</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;true-myth/task&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">function*</span><span class="hl-1"> </span><span class="hl-0">randomIncrease</span><span class="hl-1">(</span><span class="hl-6">options</span><span class="hl-1">?: { </span><span class="hl-6">from</span><span class="hl-1">: </span><span class="hl-7">number</span><span class="hl-1"> }) {</span><br/><span class="hl-1">  </span><span class="hl-4">// always use integral values, and default to one second.</span><br/><span class="hl-1">  </span><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-6">value</span><span class="hl-1"> = </span><span class="hl-6">options</span><span class="hl-1"> ? </span><span class="hl-6">Math</span><span class="hl-1">.</span><span class="hl-0">round</span><span class="hl-1">(</span><span class="hl-6">options</span><span class="hl-1">.</span><span class="hl-6">from</span><span class="hl-1">) : </span><span class="hl-9">1_000</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">while</span><span class="hl-1"> (</span><span class="hl-3">true</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">yield</span><span class="hl-1"> </span><span class="hl-6">value</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">value</span><span class="hl-1"> += </span><span class="hl-6">Math</span><span class="hl-1">.</span><span class="hl-0">ceil</span><span class="hl-1">(</span><span class="hl-6">Math</span><span class="hl-1">.</span><span class="hl-0">random</span><span class="hl-1">() * </span><span class="hl-6">value</span><span class="hl-1">); </span><span class="hl-4">// always increase!</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-6">Task</span><span class="hl-1">.</span><span class="hl-0">withRetries</span><span class="hl-1">(({ </span><span class="hl-6">count</span><span class="hl-1"> }) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-6">delay</span><span class="hl-1"> = </span><span class="hl-6">Math</span><span class="hl-1">.</span><span class="hl-0">round</span><span class="hl-1">(</span><span class="hl-6">Math</span><span class="hl-1">.</span><span class="hl-0">random</span><span class="hl-1">() * </span><span class="hl-9">100</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-6">Task</span><span class="hl-1">.</span><span class="hl-0">timer</span><span class="hl-1">(</span><span class="hl-6">delay</span><span class="hl-1">).</span><span class="hl-0">andThen</span><span class="hl-1">((</span><span class="hl-6">time</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-6">Task</span><span class="hl-1">.</span><span class="hl-0">reject</span><span class="hl-1">(</span><span class="hl-2">`Rejection #</span><span class="hl-3">${</span><span class="hl-6">count</span><span class="hl-3">}</span><span class="hl-2"> after </span><span class="hl-3">${</span><span class="hl-6">time</span><span class="hl-3">}</span><span class="hl-2">ms`</span><span class="hl-1">),</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">}, </span><span class="hl-0">randomIncrease</span><span class="hl-1">(</span><span class="hl-9">10</span><span class="hl-1">).</span><span class="hl-0">take</span><span class="hl-1">(</span><span class="hl-9">10</span><span class="hl-1">));</span>
</code><button type="button">Copy</button></pre>

</div><section class="tsd-panel"><h4>Type Parameters</h4><ul class="tsd-type-parameter-list"><li><span><a id="withretriest" class="tsd-anchor"></a><span class="tsd-kind-type-parameter">T</span></span><div class="tsd-comment tsd-typography"><p>The type of a <a href="../interfaces/task.Resolved.html" class="tsd-kind-interface"><code>Resolved</code></a> <a href="../classes/task.Task.html" class="tsd-kind-class"><code>Task</code></a>.</p>
</div><div class="tsd-comment tsd-typography"></div></li><li><span><a id="withretriese" class="tsd-anchor"></a><span class="tsd-kind-type-parameter">E</span></span><div class="tsd-comment tsd-typography"><p>The type of a <a href="../interfaces/task.Rejected.html" class="tsd-kind-interface"><code>Rejected</code></a> <a href="../classes/task.Task.html" class="tsd-kind-class"><code>Task</code></a>.</p>
</div><div class="tsd-comment tsd-typography"></div></li></ul></section><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">retryable</span>: <span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">status</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/task.RetryStatus.html" class="tsd-signature-type tsd-kind-interface">RetryStatus</a><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <a href="../classes/task.StopRetrying.html" class="tsd-signature-type tsd-kind-class">StopRetrying</a> <span class="tsd-signature-symbol">|</span> <a href="../classes/task.Task.html" class="tsd-signature-type tsd-kind-class">Task</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="task.withRetries.html#withretriest">T</a><span class="tsd-signature-symbol">,</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="task.withRetries.html#withretriese">E</a> <span class="tsd-signature-symbol">|</span> <a href="../classes/task.StopRetrying.html" class="tsd-signature-type tsd-kind-class">StopRetrying</a><span class="tsd-signature-symbol">&gt;</span></span><div class="tsd-comment tsd-typography"><p>A callback that produces a <a href="../classes/task.Task.html" class="tsd-kind-class"><code>Task&lt;T, E&gt;</code></a>.</p>
</div><div class="tsd-comment tsd-typography"></div></li><li><span><span class="tsd-kind-parameter">strategy</span>: <span class="tsd-signature-type">IterableIterator</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol"> = ...</span></span><div class="tsd-comment tsd-typography"><p>An iterable iterator that produces an integral number of
milliseconds to wait before trying <code>retryable</code> again. If not supplied, the
<code>retryable</code> will be retried immediately up to three times.</p>
</div><div class="tsd-comment tsd-typography"></div></li></ul></div><h4 class="tsd-returns-title">Returns <a href="../classes/task.Task.html" class="tsd-signature-type tsd-kind-class">Task</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="task.withRetries.html#withretriest">T</a><span class="tsd-signature-symbol">,</span> <a href="../classes/task.RetryFailed.html" class="tsd-signature-type tsd-kind-class">RetryFailed</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="task.withRetries.html#withretriese">E</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">&gt;</span></h4><div class="tsd-comment tsd-typography"></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/true-myth/true-myth/blob/e857ef92331560223bf1fea8a5d847bfe5aa4c1e/src/task.ts#L2346">src/task.ts:2346</a></li></ul></aside></li></ul></section></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#examples"><span>Examples</span></a><ul><li><a href="#retrying-with-backoff"><span>Retrying with backoff</span></a></li><li><a href="#manually-canceling-retries"><span>Manually canceling retries</span></a></li><li><a href="#using-the-retry-status-parameter"><span>Using the retry status parameter</span></a></li><li><a href="#custom-strategies"><span>Custom strategies</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">True Myth - v8.5.1</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
